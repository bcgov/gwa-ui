<div *ngIf="object">
  <form #apiForm="ngForm" role="form">
    <mat-card>
      <mat-card-content>
        <div class="flexRowToColumn">
          <mat-form-field class="flexField">
            <input matInput placeholder="Name" name="name" [(ngModel)]="object.name" required="true" pattern="[a-zA-Z][a-zA-Z0-9_\-]*" />
          </mat-form-field>
          <mat-form-field class="flexField">
            <input matInput placeholder="Upstream URL" name="upstream_url" type="url" [(ngModel)]="object.upstream_url" required="true" pattern="http(s)?://.+" />
          </mat-form-field>
          <mat-form-field class="flexField">
            <input matInput placeholder="Created At" value="{{object.created_at | date:'yyyy-MM-dd HH:mm:ss'}}" disabled />
          </mat-form-field>
        </div>
        <div class="flexRowToColumn">
          <div class="flexField labelWithButton">
            <label>Hosts:</label>
            <button (click)="addHost()" mat-icon-button style="color: green">
              <mat-icon fontSet="fa" fontIcon="fa-plus-circle" aria-label="Add"></mat-icon>
            </button>
          </div>
          <ng-template ngFor let-i="index" let-groupName [ngForOf]="object.hosts" [ngForTrackBy]="trackByIndex">
            <mat-form-field class="flexField">
              <input matInput name="host_{{i}}" [(ngModel)]="object.hosts[i]" required="true" />
              <button mdSuffix (click)="deleteHost(i)" mat-icon-button style="color: red">
                <mat-icon fontSet="fa" fontIcon="fa-trash-o"></mat-icon>
              </button>
            </mat-form-field>
          </ng-template>
        </div>
         <div class="flexRowToColumn">
          <div class="flexField labelWithButton">
            <label>Paths:</label>
            <button (click)="addUri()" mat-icon-button style="color: green">
              <mat-icon fontSet="fa" fontIcon="fa-plus-circle" aria-label="Add"></mat-icon>
            </button>
          </div>
          <ng-template ngFor let-i="index" let-groupName [ngForOf]="object.uris" [ngForTrackBy]="trackByIndex">
            <mat-form-field class="flexField">
              <input matInput name="uri_{{i}}" [(ngModel)]="object.uris[i]" required="true"  pattern="/.*" />
              <button mdSuffix (click)="deleteUri(i)" mat-icon-button style="color: red">
                <mat-icon fontSet="fa" fontIcon="fa-trash-o"></mat-icon>
              </button>
            </mat-form-field>
          </ng-template>
        </div>
        <div class="flexRowToColumn">
          <label class="flexField">Methods:</label>
          <mat-slide-toggle class="flexField" *ngFor="let methodFlag of object.method_flags" [checked]="methodFlag.enabled"
            (change)="methodFlag.enabled = $event.checked" color="primary">{{methodFlag.name}}</mat-slide-toggle>
        </div>
     
        <mat-divider class="mat-divider"></mat-divider>

        <div *ngIf="endpoint" class="flexRowToColumn">
          <div class="flexField labelWithButton">
            <label>Owner Usernames:</label>
            <button (click)="addApiOwner()" mat-icon-button style="color: green" title="Add">
              <mat-icon fontSet="fa" fontIcon="fa-plus-circle" aria-label="Add"></mat-icon>
            </button>
          </div>
          <ng-template ngFor let-i="index" let-owner [ngForOf]="endpoint.config['api_owners']" [ngForTrackBy]="trackByIndex">
            <mat-form-field class="flexField">
              <input matInput name="api_owner_{{i}}" [(ngModel)]="endpoint.config['api_owners'][i]" required="true" pattern="[a-z][a-z0-9_]*" />
              <button mdSuffix (click)="deleteApiOwner(i)" mat-icon-button style="color: red">
                <mat-icon fontSet="fa" fontIcon="fa-trash-o"></mat-icon>
              </button>
            </mat-form-field>
          </ng-template>
        </div>
        <mat-divider class="mat-divider"></mat-divider>
        <div *ngIf="keyAuth" class="flexRowToColumn">
          <mat-slide-toggle class="flexField" name="keyAuth_enabled" [(ngModel)]="keyAuth.enabled" color="primary" >Allow Developer Keys</mat-slide-toggle>
          <mat-slide-toggle class="flexField" name="keyAuth_hide_credentials" [(ngModel)]="keyAuth.config['hide_credentials']" color="primary" [disabled]="!keyAuth.enabled">Hide Credentials</mat-slide-toggle>
          <mat-form-field class="flexField">
            <input matInput placeholder="Key Name" name="keyAuth_key_names" [(ngModel)]="keyAuth.config['key_names']" required="true" [disabled]="!keyAuth.enabled" />
          </mat-form-field>
          <mat-select class="flexField" placeholder="Developer Key Group" name="developer_key_group"
            [(ngModel)]="endpoint.config['developer_key_group']"
            [disabled]="!keyAuth.enabled || !acl.enabled || developerKeyGroupNames.length == 0">
            <mat-option *ngFor="let value of developerKeyGroupNames" [value]="value">{{value}}</mat-option>
          </mat-select>
        </div>
        <mat-divider class="mat-divider"></mat-divider>
        <div *ngIf="acl" class="flexRowToColumn">
          <mat-slide-toggle class="flexField" name="acl_enabled" [(ngModel)]="acl.enabled" color="primary">Groups Enabled</mat-slide-toggle>
          <div class="flexField labelWithButton">
            <label>Group Names:</label>
            <button (click)="addGroupName()" mat-icon-button style="color: green" [disabled]="!acl.enabled">
              <mat-icon fontSet="fa" fontIcon="fa-plus-circle" aria-label="Add"></mat-icon>
            </button>
          </div>
          <ng-template ngFor let-i="index" let-groupName [ngForOf]="acl.config['whitelist']" [ngForTrackBy]="trackByIndex">
            <mat-form-field class="flexField">
              <input matInput name="groupName_{{i}}" [(ngModel)]="acl.config['whitelist'][i]" required="true" [disabled]="!acl.enabled" pattern="[a-z][a-z0-9_]*" />
              <button mdSuffix (click)="deleteGroupName(i)" mat-icon-button style="color: red" [disabled]="!acl.enabled">
                <mat-icon fontSet="fa" fontIcon="fa-trash-o"></mat-icon>
              </button>
            </mat-form-field>
          </ng-template>
        </div>
        <mat-divider class="mat-divider"></mat-divider>
        <div class="flexRowToColumn">
          <mat-slide-toggle class="flexField" name="preserve_host" [(ngModel)]="object.preserve_host" color="primary">Preserve Host</mat-slide-toggle>
          <mat-slide-toggle class="flexField" name="strip_uri" [(ngModel)]="object.strip_uri" color="primary">Strip URI</mat-slide-toggle>
          <mat-slide-toggle class="flexField" name="https_only" [(ngModel)]="object.https_only" color="primary" style="display: inline-block">Https Only</mat-slide-toggle>
          <mat-slide-toggle class="flexField" name="http_if_terminated" [(ngModel)]="object.http_if_terminated" color="primary" style="display: inline-block">Http if Terminated</mat-slide-toggle>
        </div>
        <div class="flexRowToColumn">
          <mat-form-field class="flexField">
            <input matInput placeholder="Retries" name="retries" type="number" min="0" max="32767" [(ngModel)]="object.retries" />
          </mat-form-field>
          <mat-form-field class="flexField">
            <input matInput placeholder="Connect Timeout" name="upstream_connect_timeout" type="number" min="0" [(ngModel)]="object.upstream_connect_timeout" />
          </mat-form-field>
          <mat-form-field class="flexField">
            <input matInput placeholder="Send Timeout" name="upstream_send_timeout" type="number" min="0" [(ngModel)]="object.upstream_send_timeout" /> 
          </mat-form-field>
          <mat-form-field class="flexField">
            <input matInput placeholder="Read Timeout" name="upstream_read_timeout" type="number" min="0" [(ngModel)]="object.upstream_read_timeout" />
          </mat-form-field>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button (click)="routeList()" mat-button>Close</button>
        <button (click)="save(false)" mat-raised-button color="accent" [disabled]="!apiForm.form.valid || !formValid()" *ngIf="object.id">Save</button>
        <button (click)="save(true)" mat-raised-button color="primary" [disabled]="!apiForm.form.valid || !formValid()">Save &amp; Close</button>
      </mat-card-actions>
    </mat-card>
  </form>
</div>