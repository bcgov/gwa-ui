<div *ngIf="api">
  <ol class="breadcrumb">
    <li><a [routerLink]="['/apis']">APIs</a></li>
    <li class="active">{{api.name}}</li>
  </ol>

  <tabset>
    <tab active="true">
      <template *ngIf="api.id" tabHeading >Api</template>
      <template *ngIf="api.id == null" tabHeading >Add Api</template>
      <form #apiForm="ngForm" class="form-horizontal" role="form">
        <accordion>
          <accordion-group heading="Details" isOpen="true">
            <div class="row">
              <div class="col-sm-6">
                <bs-form-group
                  [form]="apiForm"
                  name="name"
                  inputWidth=""
                >
                  <bs-input-group prefixText="Name">
                    <input #title="ngModel" name="name" [(ngModel)]="api.name" placeholder="Application Short Name" type="text" required="true" pattern="[a-z][a-z0-9]{2,20}" class="form-control"  />
                  </bs-input-group>
                </bs-form-group>
              </div>
              <div class="col-sm-6">
                <bs-form-group
                  [form]="apiForm"
                  name="title"
                  inputWidth=""
                >
                  <bs-input-group prefixText="Title">
                    <input #title="ngModel" name="title" [(ngModel)]="api.title" placeholder="Title" type="text" required="true" class="form-control"  />
                  </bs-input-group>
                </bs-form-group>
              </div>
            </div>
            <div class="row">
              <div class="col-md-3">
                <bs-form-group
                  [form]="apiForm"
                  name="enabled"
                  inputWidth=""
                >
                  <bs-input-group prefixText="Enabled">
                    <span class="form-control">
                      <input name="enabled" [(ngModel)]="api.enabled" type="checkbox" />
                    </span>
                  </bs-input-group>
                </bs-form-group>
              </div>
              <div class="col-md-3">
                <bs-form-group
                  [form]="apiForm"
                  name="strip_uri"
                  inputWidth=""
                >
                  <bs-input-group prefixText="Strip URI">
                    <span class="form-control">
                      <input name="strip_uri" [(ngModel)]="api.strip_uri" type="checkbox" />
                    </span>
                  </bs-input-group>
                </bs-form-group>
              </div>
              <div class="col-md-3">
                <bs-form-group
                  [form]="apiForm"
                  name="https_only"
                  inputWidth=""
                >
                  <bs-input-group prefixText="Https Only">
                    <span class="form-control">
                      <input name="https_only" [(ngModel)]="api.https_only" type="checkbox" />
                    </span>
                  </bs-input-group>
                </bs-form-group>
              </div>
              <div class="col-md-3">
                <bs-form-group
                  [form]="apiForm"
                  name="http_if_terminated"
                  inputWidth=""
                >
                  <bs-input-group prefixText="Http if Terminated">
                    <span class="form-control">
                      <input name="http_if_terminated" [(ngModel)]="api.http_if_terminated" type="checkbox" />
                    </span>
                  </bs-input-group>
                </bs-form-group>
              </div>
            </div>
            <bs-form-group
              [form]="apiForm"
            >
              <bs-input-group prefixText="Methods">
                <span class="form-control">
                  <label *ngFor="let methodFlag of api.method_flags" for="allowedHttpMethods" class="checkbox-inline">
                    <input type="checkbox" name="allowedHttpMethods" [checked]="methodFlag.enabled" (change)="methodFlag.enabled = $event.target.checked"> {{methodFlag.name}}
                  </label>
                </span>
              </bs-input-group>
            </bs-form-group>
            <div class="row" *ngIf="api.id">
              <div class="col-sm-6">
                <bs-form-group
                  [form]="apiForm"
                  name="created"
                  inputWidth=""
                >
                  <bs-input-group prefixText="Created By">
                    <p class="form-control form-control-static">{{api.created_by}}</p>
                  </bs-input-group>
                </bs-form-group>
              </div>
              <div class="col-sm-6">
                <bs-form-group
                  [form]="apiForm"
                  name="created"
                  inputWidth=""
                >
                  <bs-input-group prefixText="Created At">
                    <p class="form-control form-control-static">{{api.created_at | date:'yyyy-MM-dd HH:mm:ss'}}</p>
                  </bs-input-group>
                </bs-form-group>
              </div>
            </div>
          </accordion-group>
          
          <accordion-group heading="Upstream Service" isOpen="true">
            <bs-form-group
              [form]="apiForm"
              name="upstreamUrl"
              inputWidth="col-sm-12"
            >
              <bs-input-group prefixIcon="external-link">
                <input [(ngModel)]="api.upstream_url" name="upstreamUrl" placeholder="Upstream URL (e.g. http://server.com/)" type="url" required="true" pattern="https?://.+"  class="form-control"  />
              </bs-input-group>
            </bs-form-group>
            <div class="row">
              <div class="col-sm-6">    
                <bs-form-group
                  [form]="apiForm"
                  name="upstreamUsername"
                  inputWidth=""
                >
                  <bs-input-group prefixIcon="user">
                    <input [(ngModel)]="api.upstream_username" name="upstreamUsername" placeholder="Upstream Username" type="text" class="form-control" />
                  </bs-input-group>
                </bs-form-group>
              </div>
              <div class="col-sm-6">    
                <bs-form-group
                  [form]="apiForm"
                  name="upstreamPassword" 
                 inputWidth=""
                >
                  <bs-input-group prefixIcon="key">
                    <input [(ngModel)]="api.upstream_password" name="upstreamPassword" type="password" placeholder="Upstream Password" class="form-control" />
                  </bs-input-group>
                </bs-form-group>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <bs-form-group
                  [form]="apiForm"
                  name="preserve_host"
                  inputWidth=""
                >
                  <bs-input-group prefixText="Preserve Host">
                    <span class="form-control">
                      <input name="preserve_host" [(ngModel)]="api.preserve_host" type="checkbox" />
                    </span>
                  </bs-input-group>
                </bs-form-group>
              </div>
              <div class="col-md-6">
                <bs-form-group
                  [form]="apiForm"
                  name="retries"
                  inputWidth=""
                >
                  <bs-input-group prefixText="Retries">
                    <input name="retries" [(ngModel)]="api.retries" type="number" min="0" max="32767" class="form-control" />
                  </bs-input-group>
                </bs-form-group>
              </div>
            </div>
          </accordion-group>
          
        </accordion>
        <div class="btn-toolbar" role="toolbar">
          <button (click)="goBack()" class="btn btn-sm btn-default" role="button">Cancel</button>
          <button (click)="save()" class="btn btn-sm btn-primary" role="button" [disabled]="!apiForm.form.valid">Save</button>
        </div>
      </form>
    </tab>
    <tab *ngIf="api.id" heading="Plugins">
      <plugin-list [api]="api"></plugin-list>
    </tab>
  </tabset>
</div>